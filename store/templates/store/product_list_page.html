{% extends 'store/main.html' %}
{% load custom_tag %}
{% block title %}Store{% endblock %}

{% block content %}

    <div id="products-container">
        {% include 'store/show_products.html' with products=products  %}
    </div>

    <div>
        <button id="more-btn">More</button>
    </div>

    <script>
        console.log("{{page_count}}")
        var nextPage = 2   
        const moreBtn = document.getElementById('more-btn')
        const productsContainer = document.getElementById('products-container')

        moreBtn.onclick = (e) => {
            e.preventDefault()

            "{% if category_slug %}"
            url = "{% url 'store:get_more_products_by_category' category_slug %}" + `?page=${nextPage}`      
            "{% else %}"
            url = `{% url 'store:get_more_products' %}?page=${nextPage}`
            "{% endif %}"
            fetchAPI({
                url: url,
                requestInit: {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                },
                onSuccess: (data) => {
                    if (data == ''){
                        moreBtn.remove()
                        updateBtn(false)
                    }
                    else {
                        updateBtn(true)
                        productsContainer.insertAdjacentHTML("beforeend",data)
                    }
                    
                },
                onError: (error) => {
                    toast({
                        containerSelector: '#toast',
                        title: error.status || 'error',
                        body: error.statusText || error,
                        type: 'error',
                        duration: 5000
                    })
                }
            })
            function updateBtn(success) {
                if (nextPage >= Number("{{page_count}}"))
                    moreBtn.remove()
                if (success)
                    nextPage += 1
            }
        }
    </script>

{% endblock %}